{
  "data_source": null,
  "data_ending": null,
  "sections": [
    {
      "section": "C-NOS Overview",
      "description": "This section provides a key C-NOS highlights of C-NOS",
      "items": [
        {
          "simple_question": "Is our C-NOS on target by Category?",
          "sql_query": "WITH base_cnos AS (\n  -- Query 1 base: use C-NOS\n  SELECT\n    category,\n    quarter,\n    month,\n    CAST(SUBSTRING(month, 6, 2) AS INT) AS month_num,\n    SUM(CASE WHEN account = 'C-NOS' THEN CAST(forecast_act_est AS DOUBLE) END) AS cnos,\n    SUM(CASE WHEN account = 'C-NOS' THEN CAST(target           AS DOUBLE) END) AS cnos_target,\n    SUM(CASE WHEN account = 'C-NOS' THEN CAST(ya_actual        AS DOUBLE) END) AS cnos_ya\n  FROM hive_metastore.japan_gold.cnos_vw\n  WHERE month >= '2025M07' AND month <= '2025M12'\n    AND quarter IN ('JAS','OND')\n  GROUP BY category, quarter, month\n),\n\n-- ---------- Per-category rollups (C-NOS) ----------\nquarter_rollup AS (\n  SELECT\n    category,\n    quarter,\n    SUM(cnos)        AS q_cnos,\n    SUM(cnos_target) AS q_target,\n    SUM(cnos_ya)     AS q_ya\n  FROM base_cnos\n  GROUP BY category, quarter\n),\n\nhalf_year AS (\n  SELECT\n    category,\n    SUM(cnos)        AS hy_cnos,\n    SUM(cnos_target) AS hy_target,\n    SUM(cnos_ya)     AS hy_ya\n  FROM base_cnos\n  GROUP BY category\n),\n\nmonth_wide AS (\n  SELECT\n    category,\n    MAX(CASE WHEN month = '2025M07' THEN cnos END)/1000/1000/150.1 AS JULY_MM,\n    MAX(CASE WHEN month = '2025M07' THEN cnos/NULLIF(cnos_ya,0)*100 END) AS JULY_IYA,\n    MAX(CASE WHEN month = '2025M08' THEN cnos END)/1000/1000/150.1 AS AUG_MM,\n    MAX(CASE WHEN month = '2025M08' THEN cnos/NULLIF(cnos_ya,0)*100 END) AS AUG_IYA,\n    MAX(CASE WHEN month = '2025M09' THEN cnos END)/1000/1000/150.1 AS SEP_MM,\n    MAX(CASE WHEN month = '2025M09' THEN cnos/NULLIF(cnos_ya,0)*100 END) AS SEP_IYA,\n    MAX(CASE WHEN month = '2025M10' THEN cnos END)/1000/1000/150.1 AS OCT_MM,\n    MAX(CASE WHEN month = '2025M10' THEN cnos/NULLIF(cnos_ya,0)*100 END) AS OCT_IYA,\n    MAX(CASE WHEN month = '2025M11' THEN cnos END)/1000/1000/150.1 AS NOV_MM,\n    MAX(CASE WHEN month = '2025M11' THEN cnos/NULLIF(cnos_ya,0)*100 END) AS NOV_IYA,\n    SUM(CASE WHEN month IN ('2025M07','2025M08','2025M09','2025M10','2025M11') THEN cnos END)/1000/1000/150.1 AS 1H_to_date,\n    SUM(CASE WHEN month IN ('2025M07','2025M08','2025M09','2025M10','2025M11') THEN cnos END) /\n    NULLIF(SUM(CASE WHEN month IN ('2025M07','2025M08','2025M09','2025M10','2025M11') THEN cnos_ya END),0)*100 AS 1H_to_date_IYA\n  FROM base_cnos\n  GROUP BY category\n),\n\ncategory_metrics AS (\n  SELECT\n    m.category,\n    -- Quarterly KPIs (C-NOS)\n    ROUND(MAX(CASE WHEN q.quarter = 'JAS' THEN q.q_target/NULLIF(q.q_ya,0)*100 END),0) AS JAS_IYA,\n    ROUND(MAX(CASE WHEN q.quarter = 'OND' THEN q.q_target/NULLIF(q.q_ya,0)*100 END),0) AS OND_IYA,\n    ROUND((h.hy_target)/1000/1000/150.1, 0)                                          AS 1H_MM,\n    ROUND((h.hy_target/NULLIF(h.hy_ya,0))*100, 0)                                      AS 1H_IYA,\n    -- Monthly + To-Date (C-NOS)\n    ROUND(m.JULY_MM, 0)         AS JUL_MM,\n    ROUND(m.JULY_IYA, 0)        AS JUL_IYA,\n    ROUND(m.AUG_MM, 0)          AS AUG_MM,  \n    ROUND(m.AUG_IYA, 0)         AS AUG_IYA,\n    ROUND(m.SEP_MM, 0)          AS SEP_MM,  \n    ROUND(m.SEP_IYA, 0)         AS SEP_IYA,\n    ROUND(m.OCT_MM, 0)          AS OCT_MM,  \n    ROUND(m.OCT_IYA, 0)         AS OCT_IYA,\n    ROUND(m.NOV_MM, 0)          AS NOV_MM,  \n    ROUND(m.NOV_IYA, 0)         AS NOV_IYA,\n    ROUND(m.1H_to_date, 0)      AS 1H_To_Date_MM,\n    ROUND(m.1H_to_date_IYA, 0)  AS 1H_To_Date_IYA\n  FROM month_wide m\n  LEFT JOIN quarter_rollup q ON q.category = m.category\n  LEFT JOIN half_year      h ON h.category = m.category\n  GROUP BY m.category, h.hy_target, h.hy_cnos, h.hy_ya,\n           m.JULY_MM, m.JULY_IYA, m.AUG_MM, m.AUG_IYA,\n           m.SEP_MM, m.SEP_IYA, m.OCT_MM, m.OCT_IYA,m.NOV_MM,m.NOV_IYA,\n           m.1H_to_date, m.1H_to_date_IYA\n),\n\n-- ---------- TOTAL rollup (C-NOS) ----------\nt_quarter AS (\n  SELECT\n    'TOTAL' AS category,\n    quarter,\n    SUM(cnos)        AS q_cnos,\n    SUM(cnos_target) AS q_target,\n    SUM(cnos_ya)     AS q_ya\n  FROM base_cnos\n  GROUP BY quarter\n),\n\nt_half_year AS (\n  SELECT\n    'TOTAL' AS category,\n    SUM(cnos)        AS hy_cnos,\n    SUM(cnos_target) AS hy_target,\n    SUM(cnos_ya)     AS hy_ya\n  FROM base_cnos\n),\n\nt_month_wide AS (\n  SELECT\n    'TOTAL' AS category,\n    SUM(CASE WHEN month = '2025M07' THEN cnos END)/1000/1000/150.1 AS JULY_MM,\n    SUM(CASE WHEN month = '2025M07' THEN cnos END) / NULLIF(SUM(CASE WHEN month = '2025M07' THEN cnos_ya END),0) * 100 AS JULY_IYA,\n    SUM(CASE WHEN month = '2025M08' THEN cnos END)/1000/1000/150.1 AS AUG_MM,\n    SUM(CASE WHEN month = '2025M08' THEN cnos END) / NULLIF(SUM(CASE WHEN month = '2025M08' THEN cnos_ya END),0) * 100 AS AUG_IYA,\n    SUM(CASE WHEN month = '2025M09' THEN cnos END)/1000/1000/150.1 AS SEP_MM,\n    SUM(CASE WHEN month = '2025M09' THEN cnos END) / NULLIF(SUM(CASE WHEN month = '2025M09' THEN cnos_ya END),0) * 100 AS SEP_IYA,\n    SUM(CASE WHEN month = '2025M10' THEN cnos END)/1000/1000/150.1 AS OCT_MM,\n    SUM(CASE WHEN month = '2025M10' THEN cnos END) / NULLIF(SUM(CASE WHEN month = '2025M10' THEN cnos_ya END),0) * 100 AS OCT_IYA,\n    SUM(CASE WHEN month = '2025M11' THEN cnos END)/1000/1000/150.1 AS NOV_MM,\n    SUM(CASE WHEN month = '2025M11' THEN cnos END) / NULLIF(SUM(CASE WHEN month = '2025M11' THEN cnos_ya END),0) * 100 AS NOV_IYA,\n    SUM(CASE WHEN month IN ('2025M07','2025M08','2025M09','2025M10','2025M11') THEN cnos END)/1000/1000/150.1 AS 1H_to_date,\n    SUM(CASE WHEN month IN ('2025M07','2025M08','2025M09','2025M10','2025M11') THEN cnos END) /\n    NULLIF(SUM(CASE WHEN month IN ('2025M07','2025M08','2025M09','2025M10','2025M11') THEN cnos_ya END),0)*100 AS 1H_to_date_IYA\n  FROM base_cnos\n),\n\ntotal_metrics AS (\n  SELECT\n    m.category,\n    ROUND(MAX(CASE WHEN q.quarter = 'JAS' THEN q.q_target/NULLIF(q.q_ya,0)*100 END),0) AS JAS_IYA,\n    ROUND(MAX(CASE WHEN q.quarter = 'OND' THEN q.q_target/NULLIF(q.q_ya,0)*100 END),0) AS OND_IYA,\n    ROUND((h.hy_target)/1000/1000/150.1, 0)                                          AS 1H_MM,\n    ROUND((h.hy_target/NULLIF(h.hy_ya,0))*100, 0)                                      AS 1H_IYA,\n    ROUND(m.JULY_MM, 0)         AS JUL_MM,\n    ROUND(m.JULY_IYA, 0)        AS JUL_IYA,\n    ROUND(m.AUG_MM, 0)          AS AUG_MM,  \n    ROUND(m.AUG_IYA, 0)         AS AUG_IYA,\n    ROUND(m.SEP_MM, 0)          AS SEP_MM,  \n    ROUND(m.SEP_IYA, 0)         AS SEP_IYA,\n    ROUND(m.OCT_MM, 0)          AS OCT_MM,  \n    ROUND(m.OCT_IYA, 0)         AS OCT_IYA,\n    ROUND(m.NOV_MM, 0)          AS NOV_MM,  \n    ROUND(m.NOV_IYA, 0)         AS NOV_IYA,\n    ROUND(m.1H_to_date, 0)      AS 1H_To_Date_MM,\n    ROUND(m.1H_to_date_IYA, 0)  AS 1H_To_Date_IYA\n  FROM t_month_wide m\n  LEFT JOIN t_quarter q ON q.category = m.category\n  LEFT JOIN t_half_year h ON h.category = m.category\n  GROUP BY m.category, h.hy_target, h.hy_cnos, h.hy_ya,\n           m.JULY_MM, m.JULY_IYA, m.AUG_MM, m.AUG_IYA,\n           m.SEP_MM, m.SEP_IYA, m.OCT_MM, m.OCT_IYA,m.NOV_MM,m.NOV_IYA,\n           m.1H_to_date, m.1H_to_date_IYA\n),\n\n-- ---------- logic for GIV ----------\ngiv_category AS (\n  SELECT\n    category,\n    SUM(CASE WHEN month IN ('2025M07','2025M08','2025M09','2025M10','2025M11') THEN giv END) /\n    NULLIF(SUM(CASE WHEN month IN ('2025M07','2025M08','2025M09','2025M10','2025M11') THEN giv_ya END),0) * 100\n      AS GIV_1H_to_date_IYA\n  FROM (\n    SELECT\n      category,\n      month,\n      SUM(CASE WHEN account = 'GIV' THEN CAST(forecast_act_est AS DOUBLE) END) AS giv,\n      SUM(CASE WHEN account = 'GIV' THEN CAST(ya_actual        AS DOUBLE) END) AS giv_ya\n    FROM hive_metastore.japan_gold.cnos_vw\n    WHERE month >= '2025M07' AND month <= '2025M12'\n    GROUP BY category, month\n  ) s\n  GROUP BY category\n),\n\ngiv_total AS (\n  SELECT\n    'TOTAL' AS category,\n    SUM(CASE WHEN month IN ('2025M07','2025M08','2025M09','2025M10','2025M11') THEN giv END) /\n    NULLIF(SUM(CASE WHEN month IN ('2025M07','2025M08','2025M09','2025M10','2025M11') THEN giv_ya END),0) * 100\n      AS GIV_1H_to_date_IYA\n  FROM (\n    SELECT\n      month,\n      SUM(CASE WHEN account = 'GIV' THEN CAST(forecast_act_est AS DOUBLE) END) AS giv,\n      SUM(CASE WHEN account = 'GIV' THEN CAST(ya_actual        AS DOUBLE) END) AS giv_ya\n    FROM hive_metastore.japan_gold.cnos_vw\n    WHERE month >= '2025M07' AND month <= '2025M12'\n    GROUP BY month\n  ) s\n),\n\ngiv_union AS (\n  SELECT * FROM giv_category\n  UNION ALL\n  SELECT * FROM giv_total\n),\n\nfinal_union AS (\n  SELECT\n    f.*,\n    ROUND(g.GIV_1H_to_date_IYA, 0) AS GIV_1H_to_date_IYA\n  FROM (\n    SELECT * FROM category_metrics\n    UNION ALL\n    SELECT * FROM total_metrics\n  ) f\n  LEFT JOIN giv_union g\n    ON g.category = f.category\n)\n\n-- ---------- Final output: append last two columns in exact order ----------\nSELECT\nfinal_union.* EXCEPT(GIV_1H_to_date_IYA), \n  (`1H_IYA` - `1H_To_Date_IYA`) AS `vs_Target`,      \n  ROUND(GIV_1H_to_date_IYA, 0) AS `GIV_1H_to_date_IYA`,            \n  (`1H_To_Date_IYA` - GIV_1H_to_date_IYA) AS `Gap_VS._C-NOS`      \n\nFROM final_union\nORDER BY\n  CASE category\n    WHEN 'TOTAL'           THEN 0\n    WHEN 'Detergent'       THEN 1\n    WHEN 'Fabric Enhancer' THEN 2\n    WHEN 'Dish'            THEN 3\n    WHEN 'Air'             THEN 4 \n    WHEN 'Baby'            THEN 5 \n    WHEN 'Fem'             THEN 6\n    WHEN 'Hair'            THEN 7\n    WHEN 'Shave'           THEN 8\n    WHEN 'Oral'            THEN 9\n    WHEN 'Braun'           THEN 10\n    WHEN 'POC'             THEN 11\n    ELSE 99\n  END ASC;\n",
          "sql_result": null,
          "reference": "Your analysis must strictly follow the following format. Do not add text nor line by yourself.\n\n- As Japan MO total, Oct C-NOS delivered XXX IYA with XXX $MM.\n- With this, 1H To Date C-NOS is XXX IYA with XXX $MM which is -Xpt vs. 1H target (XXX IYA)\n      - By Category: Over-delivery in Category A (+X% vs. 1H Target), Category B (+X%), ..., under-delivery in Laundry (-X%), ... .\n        - By Team: Over-delivery in D-Com (+X%), under-deliery in Team A (-X%), ...\n        - By Top Customer: Over-delivery in Customer (+X%), TSURUYA (+X%), under-delivery in Customer C (-X%),...\n - If it's asked IYA, the numbers should be between 0~100 \n - If go over target, use Green color and underline to highlight for numbers. For customer & category, make it bold and colored\n  - If below target, use Red color and underline to highlight for numbers. For customer & category, make it bold and colored.\n\nNext, present a rich interactive HTML table with all boarders, the table structure will be following the below detailed specifications\n\n1. Table Structure & Hierarchy\nThe table must have a multi-level (three-tier) column header structure.\n - Row header: The first column is for categories, with the header \"By Category\"\n - Column Group (Top Level): The columns are organized into four primary sections. All top-level headers are centered across the columns they span.\n    - \"Target\"\n    - \"C-NOS Actuals\"\n    - \"vs Target\"\n    - \"GIV\"\n - Detailed column Breakdown (Second and Third Tiers):\n    - Group 1: Target\n        - Sub-group: JAS\n            - Column: IYA\n        - Sub-group: OND\n            - Column: IYA\n        - Sub-group: 1H\n            - Column: IYA, $MM\n    - Group 2: C-NOS Actuals\n        - Sub-group: JUL, AUG, SEP, OCT, NOV, DEC, 1H To Date\n          *Only show when data is available in the table\n        - Each sub-group from JUL to Dec contains two columns: IYA and $MM\n        - The \"1H To Date\" sub-group contains two columns: IYA and $MM\n    - Group 3: vs Target\n        - This is a single-column group with the header IYA\n    - Group 4: GIV\n        - Sub-group: \"1H to Date IYA\"\n        - Sub-group: \"Gap vs. C-NOS\"\n\n2. Styling and Conditional Formatting\n - Headers:\n    - All header cell (all three tiers) must have a light gray background (#E7E6E6)\n    - All header text must be bold and centered within their respective cells or merged cell groups.\n - Total Raw:\n    - The entire TOTAL data row must have a light blue background (#D9E1F2)\n - Conditional Formatting:\n    - Apply conditional formatting to the IYA column under the \"vs Target\" Group:\n        - Cells with positive or zero value (>=0) must have a light green background (#C6E0B4)\n        - Cells with negative value (<0) must have a light red background (#F8CBAD).\n - Borders:\n    - Use a prominent horizontal boarder to separate the header section from the data rows.\n    - Use prominent vertical boarders to visually separate the main column groups (\"Target\", \"C-NOS Actuals\", \"vs Target\", \"GIV\").\n    - Use standard thin boarders for all other cell separations, both horizontally between rows and vertically between individual columns.\n\n3. Data Formatting\n - All values in IYA must be formatted as percentages with an integer value followed by the \"%\" signs (e.g., 109%, -8%)\n - All values in columns titled $MM must be formatted as integers with no decimal places or currency symbols.\n\nAvailable data: {}",
          "number_of_plots": 0
        }
      ],
      "section_llm": null
    }
  ],
  "agent_version": "v1",
  "system_prompts": {
    "section_writer_prompt": "\nYou are an agent who is an expert business report writer for Procter & Gamble, specializing in data analysis.\nPlease keep going until the user’s query is completely resolved, before ending your turn and yielding back to the user.Only terminate your turn when you are sure that the problem is solved.\n\n# Task\nWrite the '{section_title}' section of a business report.\n\n# Context\n`{section_description}`\n\n# Data and Instructions from user\n- Outline a specific, simple, and verifiable sequence of steps to address what the user wants to achieve in this section.\n- Here is the data from the user:\n`{items}`\n\n# Output Format\n- Strictly {report_format} format\n- Begin with the section title as a level-2 heading\n- Follow all formatting rules for tables, lists, graph, etc.\n\n# Requirements\n1. Use only the provided data - DO NOT introduce external facts or data\n2. Analyze metrics explaining business meaning without mentioning raw column names\n3. Ensure all insights directly connect to the underlying data\n\n# Instructions\n- If you receive any IMAGE_<plotid> placeholders at the end of the instructions, include them EXACTLY as returned by the tool\n- Do not try to render the IMAGE_<plotid> yourself, they will be handled later\n- Do not create or modify any IMAGE_<plotid> references yourself\n- Never wrap IMAGE_<plotid> in any HTML or markdown tags, paste them as they are\n\n# Key Terms\n- P1M: Past 1 month (most recent)\n- P3M: Past 3 months\n- P6M: Past 6 months\n- P12M: Past 12 months\n- IYA: Index Year Ago (current ÷ last year x 100)\n- CCC: Customer Category Combination\n- $MM: 1,000,000 USD.\n\n# Process\n1. First, plan your section structure based on the data\n2. Write section content following {report_format} conventions\n3. Verify all IMAGE_plotid references match exactly with tool responses\n",
    "report_compiler_prompt": "You are an expert business report writer.\nYour task is to compile the following sections into a single,\ncohesive business report.\n\n## Sections\n{sections}\n\n## Instructions\n- Output must be strictly in {report_format} format.\n- Begin with a level 1 heading for the report title.\n- Present each section in the order provided, using their {report_format} headings\n- If you receive an executive summary section:\n    * Present the Executive Summary first, then each section in the order provided, using their {report_format} headings.\n    * If you receive more than one summary sections, combine them into **a single section** titled Executive Summary, combining their insights in a concise manner.\n- Do not alter the content of each section, except for adding brief transitions or a summary if needed for clarity.\n- Ensure logical flow and smooth transitions.\n- Do not add or omit any information.\n- IMPORTANT: If you receive any image placeholders in the format in the format IMAGE_<plotid>, where a valid <plotid> is a random 8-character alphanumeric identifier,\n    it must be included verbatim in the report to be replaced with the actual image later. Not in any other format (i.e. IMAGE_plotID, IMAGE_1, etc.) as they may have been hallucinated.\n- IMPORTANT 2: \n- Preserve all image placeholders related to plots exactly as they appear in the tool response, thye will be rendered later. Ensure the report is in 70% of the viewport width, don't consume the full viewable screen. \n- Have the report title 'C-NOS Overview on Oct 2025' h1 tag, centerlined with solid #0037b1 color line below every section name. \n\n**Remember: Output must be strictly in {report_format} format.**\n**Preserve all **valid** `IMAGE_plotid` tags verbatim.**",
    "report_format_checker_prompt": "You are a meticulous business report editor for Procter & Gamble, specializing in data analysis reports.\nReview the following {report_format} business report for:\n- Readability and clarity\n- Consistent {report_format} formatting (headings, tables, lists)\n- Professional tone and language\n- Correct use of {report_format} syntax\n- IMPORTANT: Preserve all image placeholders `IMAGE_plotID` related to plots exactly as they appear in the tool response, they will be rendered later.\n  Note that the 'plotID' part of the placeholder, is the first 8 characters of a random generated UUID4 string,\n  therefore if you notice any hallucinated tags like `IMAGE_1`, `IMAGE_plotID` (verbatim), or any other tag that does not follow the format, you should remove it.\n\n## Report to Review:\n`{report}`.\n\n## Instructions\n- If the report is well-formatted, return the improved version with any minor corrections.\n- Ensure the report is in 70% of the viewport width, don't consume the full viewable screen. \n- If the report is well-formatted, return the improved version with any minor corrections.\n- If there are issues, fix them and output the corrected {report_format}.\n- Ensure all tables have proper alignment and headers.\n- Check that metrics are explained without using column names.\n- Do not add new content or remove existing information.\n- Do not skip, summarize or alter\n- Output must be strictly in {report_format} format.\n- IMPORTANT: Preserve all valid image placeholders related to plots exactly as they appear in the tool response, they will be rendered later.\n\n**Remember: Output must be strictly in {report_format} format, and do not output any other comments other than the report.**\n**Preserve all valid `IMAGE_plotid` tags verbatim.**\n",
    "executive_summary_prompt": "\nYou are a senior business analyst at Procter & Gamble.\nYour mission: create a concise, senior-executive-ready Executive Summary that synthesizes key findings from the report sections below, highlighting trends, risks, and actionable opportunities.\n\nContext:\n{sections}\n\nOutput Requirements:\n- Format: strictly {report_format}\n- Length: **2000-3000 words**\n- Audience: senior execs — **clear, actionable, jargon-free**\n- Begin with a short opening paragraph summarizing overall performance\n- Include a bulleted list of **3-6 bullet points** that:\n  * Synthesize insights across multiple report sections\n  * Highlight top trends, emerging risks, and strategic opportunities\n  * Rephrase—**avoid verbatim sentences**\n- Use content **only** from the provided sections—**no new data**\n- If an “Executive” or “Topline Summary” section already exists, **build on it** and enrich with cross-section analysis\n- **Do not add any other headings or closing remarks**; start with: an Executive Summary h2 heading.\n"
  },
  "additional_rules": null,
  "node_models": {
    "check_format": "GPT-41-2025-04-14",
    "compile_report": "GPT-41-2025-04-14",
    "plan_sections": "GPT-41-2025-04-14",
    "generate_plots": "GPT-41-2025-04-14"
  },
  "email_recipients": null
}